<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>小说阅读器</title>
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"
    />
    <link rel="stylesheet" href="../css/iconfont.css" />
    <script>
      /**
       * 定义框架兼容模块
       */
      new (function () {
        function change() {
          document.documentElement.style.fontSize =
            (100 * document.documentElement.clientWidth) / 750 + "px";
        }
        change();
        window.addEventListener("resize", change, false);
      })();

      function resize() {
        let htmlEle = document.documentElement;
        let htmlWidth = window.innerWidth;
        if (!htmlWidth) return;
        if (htmlWidth >= 750) {
          htmlEle.style.fontSize = "100px";
        } else {
          htmlEle.style.fontSize = 100 * (htmlWidth / 750) + "px";
        }
      }

      resize();
    </script>
    <link rel="stylesheet" href="../css/index.css" />
  </head>
  <body id="r-body">
    <header id="r-header">
      <div class="r_back_last">
        <span class="iconfont icon-jiantouzuo"></span>
      </div>
      <div class="r_book_name">遮天</div>
      <div class="r_back_home">
        <span class="iconfont icon-zhuye"></span>
      </div>
    </header>

    <aside id="r-aside">
      <div class="r_menu">
        <div class="r_book_desc">
          <div class="r_book_cover">
            <img src="../img/book.jfif" />
          </div>
          <div class="r_book_info">
            <div class="r_book_info_name">遮天</div>
            <div class="r_book_info_author">辰东</div>
          </div>
          <div class="r_book_go_info">
            <span class="iconfont icon-jiantouyou"></span>
          </div>
        </div>
        <ul id="r-book-menu"></ul>
      </div>
    </aside>
    <div class="header">顶部内容</div>
    <section class="r_book_content" id="r-section">
      <div class="r_book_title">第一章 星空中的青铜巨棺</div>
      <p>　　生命是世间最伟大的奇迹。</p>
      <p>
        　　四方上下曰宇。宇虽有实，而无定处可求。往古来今曰宙。宙虽有增长，不知其始之所至。
      </p>
      <p>
        　　浩瀚的宇宙，无垠的星空，许多科学家推测，地球可能是唯一的生命源地。
      </p>
      <p>
        　　人类其实很孤独。在苍茫的天宇中，虽然有亿万星辰，但是却很难寻到第二颗生命源星。
      </p>
      <p>
        　　不过人类从来没有放弃过探索，自上世纪以来已经发射诸多太空探测器。
      </p>
      <p>
        　　旅行者二号是一艘无人外太空探测器，于一九七七年在美国肯尼迪航天中心发射升空。
      </p>
      <p>
        　　它上面携带着一张主题为“向宇宙致意”的镀金唱片，里面包含一些流行音乐和用地球五十五种语言录制的问候辞，以冀有一天被可能存在的外星文明拦截和收到。
      </p>
      <p>
        　　从上世纪七十年代到现在，旅行者二号一直在孤独的旅行，在茫茫宇宙中它如一粒尘埃般渺小。
      </p>
      <p>
        　　同时代的外太空探测器，大多或已经发生故障，或已经中断讯号联系，永远的消失在了枯寂的宇宙中。
      </p>
      <p>
        　　三十几年过去了，科技在不断发展，人类已经研制出更加先进的外太空探测器，也许不久的将来对星空的探索会取得更进一步的发展。
      </p>
      <p>
        　　但纵然如此，在相当长的时间内，新型外太空探测器依然无法追上旅行者二号的步伐。
      </p>
      <p>　　三十三年过去了，旅行者二号距离地球已经有一百四十亿公里。</p>
      <p>
        　　此时此刻，它已经达到第三宇宙速度，轨道再也不能引导其飞返太阳系，成为了一艘星际太空船。
      </p>
      <p>
        　　黑暗与冰冷的宇宙中，星辰点点，犹如一颗颗晶莹的钻石镶嵌在黑幕上。
      </p>
      <p>
        　　旅行者二号太空探测器虽然正在极速飞行，但是在幽冷与无垠的宇宙中却像是一只小小的蚁虫在黑暗的大地上缓缓爬行。
      </p>
      <p>　　三十多年过去后，就在今日这一刻，旅行者二号有了惊人的发现！</p>
      <p>　　在枯寂的宇宙中，九具庞大的尸体静静的横在那里……</p>
      <p>
        　　二零一零年五月二十二日，美国宇航局接收到旅行者二号传送回的一组神秘的数据信息，经过艰难的破译与还原，他们看到了一幅不可思议的画面。
      </p>
      <p>
        　　在这一刻宇航局主监控室内所有人同时变色，最后如木雕泥塑般一动不动，他们震惊到了无以复加的地步！
      </p>
      <p>　　直至过了很久众人才回过神来，而后主监控室内一下子沸腾了。</p>
      <p>　　“上帝，我看到了什么？”</p>
      <p>　　“这怎么可能，无法相信！”</p>
      <p>　　……</p>
      <p>
        　　旅行者二号早已不受引导，只能单一的前进，传送回这组神秘的数据信息后，在那片漆黑的宇宙空间匆匆而过，驶向更加幽暗与深远的星域。
      </p>
      <p>
        　　由于那片星空太遥远，纵然有了重大发现，捕捉到了一幅震撼性的画面，人类目前也无能为力。
      </p>
      <p>
        　　这组神秘信息并没有对外公布。而不久后，旅行者二号发生了故障，中断了与地球的讯号传送。
      </p>
      <p>
        　　也许至此可以画上一个句号了，不过有时候事情往往会出乎人们的预料。
      </p>
      <p>
        　　无论是对星空的观测与探索，还是进行生命与物理的科学研究，空间站都具有得天独厚的优越环境。
      </p>
      <p>
        　　从一九七一年苏联首先发射载人空间站成功，到目前为止全世界已发射了九个空间站。
      </p>
      <p>
        　　二零一零年六月十一日，此时此刻，绕地而行的国际空间站内，几名宇航员同时变了颜色，瞳孔急骤收缩。
      </p>
      <p>
        　　时至今日，神的存在，早已被否定。如果还有人继续信仰，那也只是因心灵空虚而寻找一份寄托而已。
      </p>
      <p>
        　　但是就在这一刻，几名宇航精英的思想受到了强烈的的冲击，他们看到了一幅不可思议的画面。
      </p>
      <p>
        　　在国际空间站外，冰冷与黑暗并存的宇宙中，九条庞然大物一动不动，仿佛亘古就已横在那里，让人感觉到无尽的苍凉与久远，那竟然是九具龙尸！
      </p>
      <p>　　与古代神话传说中的龙一般无二。</p>
      <p>　　每具龙尸都长达百米，犹如铁水浇铸而成，充满了震撼性的力感。</p>
      <p>
        　　九具龙尸皆是五爪黑龙，除却龙角晶莹剔透、紫光闪闪外，龙身通体呈黑色，乌光烁烁，鳞片在黑暗中闪烁着点点神秘的光华。
      </p>
      <p>
        　　龙，传说中的存在，与神并立，凌驾于自然规律之上。但是，科学发展到现在，还有谁会相信龙真的存在？
      </p>
      <p>
        　　国际空间站内的几名宇航员，思想受到了强烈的冲击，眼前所见让他们感觉不可思议！
      </p>
      <p>
        　　枯寂的宇宙中，冰冷的龙尸似不可摧毁的钢铁长城，甚至能够感觉到尸身中所蕴含的恐怖力量。
      </p>
      <p>　　只是，它们已经失去了生气，永远的安息在了幽冷的宇宙空间中。</p>
      <p>　　“那是……”</p>
      <p>
        　　被深深震撼过后，几名宇航精英的瞳孔再次急骤收缩，他们看到了更为让人震惊的画面。
      </p>
      <p>
        　　九具龙尸都长达百米，在尾端皆绑缚着碗口粗的黑色铁索，连向九具龙尸身后那片黑暗的宇宙空间，在那里静静的悬着一口长达二十米的青铜棺椁。
      </p>
      <p>　　巨索千锤百炼，粗长而又坚固，点点乌光令它显得阴寒无比。</p>
      <p>
        　　青铜巨棺古朴无华，上面有一些模糊的古老图案，充满了岁月的沧桑感，也不知道在宇宙中漂浮多少年了。
      </p>
      <p>　　九龙拉棺！</p>
      <p>
        　　在这漆黑而又冰冷的宇宙中，九具龙尸与青铜巨棺被粗长的黑色铁索连在一起，显得极其震撼。
      </p>
      <p>
        　　在面对那不可思议的监控画面一阵失神后，几名宇航精英第一时间发出了呼叫讯号。
      </p>
      <p>　　“呼叫地球……”</p>
      <p></p>
    </section>
    <div class="footer">底部内容</div>
    <footer id="r-footer">
      <div class="r_setting_box" id="r-setting-box">
        <div class="r_setting_list">
          <div class="r_setting_li">
            <div class="r_setting_progress" id="r-setting-bar">
              <div class="r_setting_now r_setting_now_font" id="r-setting-now">
                <div
                  class="r_setting_circle r_setting_circle_font"
                  id="r-setting-circle"
                >
                  16
                </div>
              </div>
            </div>
            <div class="r_setting_word">
              <span class="r_setting_word_small">A</span>
              <span class="r_setting_word_big">A</span>
            </div>
          </div>
          <div class="r_setting_li">
            <div class="r_setting_progress" id="r-setting-bar-row">
              <div
                class="r_setting_now r_setting_now_row"
                id="r-setting-now-row"
              >
                <div
                  class="r_setting_circle r_setting_circle_row"
                  id="r-setting-circle-row"
                >
                  行距
                </div>
              </div>
            </div>
            <div class="r_setting_word">
              <span class="r_setting_word_big">紧</span>
              <span class="r_setting_word_big">松</span>
            </div>
          </div>
        </div>
        <div class="r_setting_list">
          <div class="r_setting_style" id="r-setting-font">
            <div class="r_setting_name">系统字体</div>
            <div class="r_setting_icon">
              <span class="iconfont icon-jiantouyou"></span>
            </div>
          </div>
          <div class="r_setting_style" id="r-setting-way">
            <div class="r_setting_name">翻页方式</div>
            <div class="r_setting_icon">
              <span class="iconfont icon-jiantouyou"></span>
            </div>
          </div>
        </div>
      </div>

      <div class="r_theme_box" id="r-theme-box">
        <div class="r_theme_list" id="r-theme-list"></div>
      </div>

      <div class="r_progress" id="r-progress-box">
        <div class="r_progress_title" id="r-progress-title">
          第一章 星空中的青铜巨棺
        </div>
        <div class="r_progress_bar">
          <div class="r_progress_last r_progress_change" data-type="last">
            <span class="iconfont icon-jiantouzuo"></span>
          </div>
          <div class="r_progress_content" id="r-progress-bar">
            <div class="r_progress_now" id="r-progress-now">
              <div class="r_progress_circle" id="r-progress"></div>
            </div>
          </div>
          <div class="r_progress_next r_progress_change" data-type="next">
            <span class="iconfont icon-jiantouyou"></span>
          </div>
        </div>
      </div>

      <div class="r_operation">
        <div class="r_operation_menu" id="r-menu">
          <span class="iconfont icon-RectangleCopy"></span>
        </div>
        <div class="r_operation_theme" id="r-theme">
          <span class="iconfont icon-taiyang"></span>
        </div>
        <div class="r_operation_setting" id="r-setting">
          <span class="iconfont icon-xianxingtubiao_huabanfuben"></span>
        </div>
      </div>
    </footer>

    <div class="r_change_style" id="r-change-style">
      <div class="r_change_box">
        <div class="r_change_title" id="r-change-title">字体</div>
        <div class="r_change_icon">
          <span class="iconfont icon-jiantouxia"></span>
        </div>
      </div>
      <div class="r_change_list" id="r-change-font"></div>
      <div class="r_change_list" id="r-change-way"></div>
    </div>

    <div class="r_mask" id="r-m-mask"></div>
    <div class="r_mask" id="r-mask"></div>

    <script src="../js/jquery.min.js"></script>
    <script src="../js/info.js"></script>
    <script>
      /**
       * 初始化数据
       */
      const rSection = document.querySelector("#r-section");
      const rContent = document.querySelector("#r-section"); // 假设 rContent 是 id 为 rContent 的 DOM 元素
      const rFooter = document.getElementById("r-footer");
      const rHeader = document.getElementById("r-header");
      const rMMask = document.getElementById("r-m-mask");
      const rMask = document.getElementById("r-mask");
      const rAside = document.querySelector("#r-aside");
      const rBookMenu = document.querySelector("#r-book-menu");
      let contentWidth, contentScrollWidth;
      let changeKey = "0";
      let index, maxCount;
      function init() {
        // 设置阅读器column宽度
        contentWidth = rSection.clientWidth + rSection.offsetLeft + 2;
        rSection.style.setProperty("column-width", contentWidth + "px");
        contentScrollWidth = rSection.scrollWidth;
        maxCount = parseInt(contentScrollWidth / contentWidth);
        setMenu();
        setTheme();
      }
      init();

      /**
       * 初始化目录
       */
      function setMenu() {
        let menu = bookData["data"]["vs"];
        let content = "";
        menu.forEach(function (list) {
          content += ' <li class="chapter-bar">' + list["vN"] + "</li>";
          list["cs"].forEach(function (item) {
            content +=
              '<li class="chapter-li jsChapter">\n' +
              '         <a href="#" class="chapter-li-a " data-chapter-id="' +
              item["id"] +
              '" role="option">\n' +
              '            <span class="chapter-index ">' +
              item["cN"] +
              "</span>\n" +
              "         </a>\n" +
              "       </li>";
            menuMap.push({ id: item["id"], name: item["cN"] });
          });
        });
        rBookMenu.innerHTML = content;
      }

      /**
       * 初始化皮肤
       */
      function setTheme() {
        // 初始化皮肤
        let content = "";
        colorMap.forEach(function (item, index) {
          let b_color = item["r_color"];
          if (index === 0) {
            // 第一条默认选中
            b_color = item["b_color"];
          }

          let icon = "";
          if (item["r_color"] === "#000000") {
            // 夜间模式添加icon图
            icon = '<span class="iconfont icon-yueliang"></span>';
          }

          content +=
            '<div class="r_theme_li" style="background-color: ' +
            item["r_color"] +
            ";border: 2px solid " +
            b_color +
            '" data-index="' +
            index +
            '">' +
            icon +
            "</div>";
        });

        $("#r-theme-list").html(content);
      }

      /**
       * 切换皮肤
       */
      $("#r-theme-list").on("click", ".r_theme_li", function () {
        let index = $(this).attr("data-index");
        $(".r_theme_li").each(function (i, n) {
          $(n).css("border", "2px solid " + colorMap[i]["r_color"]);
        });
        $(this).css("border", "2px solid " + colorMap[index]["b_color"]);

        // 阅读器背景色
        $("#r-body").css("background", colorMap[index]["r_color"]);
        $("#r-body").css("color", colorMap[index]["color"]);
        $(".r_book_title").css("color", colorMap[index]["color"]);

        // 顶部标题栏
        $("#r-header").css("background", colorMap[index]["s_color"]);
        $("#r-header").css("color", colorMap[index]["color"]);
        $(".r_book_name").css("color", colorMap[index]["color"]);

        // 底部操作栏
        $("#r-footer").css("background", colorMap[index]["s_color"]);
        $("#r-footer").css("color", colorMap[index]["color"]);

        // 侧边栏
        $("#r-aside").css("background", colorMap[index]["s_color"]);
        $("#r-aside").css("color", colorMap[index]["color"]);
      });

      /**
       * 关闭遮罩
       */
      rMMask.addEventListener("click", function () {
        rMMask.style.visibility = "hidden";
        rAside.style.left = "-80%";
      });

      /**
       * 拖动进度条
       */
      let now = $("#r-progress-now");
      let bar = $("#r-progress-bar");
      $("#r-progress").on("touchstart", function () {
        let chapterId;
        let width = 60;
        let width_bar = bar[0].offsetWidth - this.offsetWidth - 3;
        let _this = this;

        _this.ontouchmove = function (ev) {
          ev = ev || window.event;
          let width_new = ev.changedTouches[0].clientX - width;
          if (width_new <= 0) {
            width_new = 0;
          }
          console.log(width_new, width_bar);
          if (width_new >= width_bar) {
            width_new = width_bar;
          }

          let percent =
            (width_new / width_bar).toFixed(2) > 0.99
              ? 1
              : (width_new / width_bar).toFixed(2);
          let menuLength = menuMap.length;
          console.log(percent * menuLength);
          index = parseInt(percent * menuLength);

          index = index >= menuLength ? menuLength - 1 : index;
          $("#r-progress-title").html(menuMap[index]["name"]);
          chapterId = menuMap[index]["id"];

          now.css("width", width_new + "px");
        };

        _this.ontouchend = function () {
          document.ontouchmove = null;
          _this.ontouchmove = null;
          changeChapter(chapterId);
        };
      });

      /**
       * 手动切换章节
       */
      $(".r_progress_change").click(function () {
        let type = $(this).attr("data-type");
        let chapterId;
        switch (type) {
          case "next":
            index++;
            break;
          default:
            index--;
        }

        index = index <= 0 ? 0 : index;
        index = index >= menuMap.length ? menuMap.length - 1 : index;
        chapterId = menuMap[index]["id"];

        // 展示章节名并更新拖动条进度
        $("#r-progress-title").html(menuMap[index]["name"]);

        changeChapter(chapterId);
      });

      /**
       * 切换章节
       */
      function changeChapter(chapterId) {
        // 发送请求，获取章节信息
        console.log(chapterId);
      }

      /**
       * 操作目录
       */
      $("#r-menu").click(function () {
        $("#r-aside").css("left", 0);
        $("#r-m-mask").css("visibility", "unset");
      });

      /**
       * 换肤
       */
      $("#r-theme").click(function () {
        $("#r-theme-box").css("display", "block");
        $("#r-progress-box").css("display", "none");
        $("#r-setting-box").css("display", "none");
      });

      /**
       * 设置
       */
      $("#r-setting").click(function () {
        $("#r-theme-box").css("display", "none");
        $("#r-progress-box").css("display", "none");
        $("#r-setting-box").css("display", "block");
      });

      /**
       * 设置字体
       */
      $("#r-setting-font").click(function () {
        $("#r-change-style").css("display", "block");
        $("#r-footer").css("display", "none");
        $("#r-header").css("display", "none");
        $("#r-change-font").css("display", "block");
        $("#r-change-way").css("display", "none");
        $(".r_change_box").css("border", "0");
        $("#r-change-title").html("字体");

        let content = "";
        fontMap.forEach(function (value, key) {
          value = value === "默认字体" ? "华文楷体" : value;
          let select = key === 0 ? "r_change_li_select" : "";
          content +=
            '<div class="r_change_li ' +
            select +
            '" data-key="' +
            key +
            '" style="font-family: ' +
            value +
            '">' +
            value +
            "</div>";
        });

        $("#r-change-font").html(content);
      });

      /**
       * 切换字体
       */
      $("#r-change-font").on("click", ".r_change_li", function () {
        let key = $(this).attr("data-key");
        $(".r_change_li").removeClass("r_change_li_select");
        $(this).addClass("r_change_li_select");

        $("#r-body").css("font-family", fontMap[key]);
      });

      /**
       * 设置翻页方式
       */
      $("#r-setting-way").click(function () {
        $("#r-change-style").css("display", "block");
        $("#r-footer").css("display", "none");
        $("#r-header").css("display", "none");
        $("#r-change-font").css("display", "none");
        $("#r-change-way").css("display", "block");
        // $('.r_change_box').css('border-bottom', '0.1px solid #0d141e');
        $("#r-change-title").html("翻页方式");

        let content = "";
        wayMap.forEach(function (value, key) {
          let select =
            key === parseInt(changeKey) ? "r_change_way_li_select" : "";
          content +=
            '<div class="r_change_way_li ' +
            select +
            '" data-key="' +
            key +
            '">' +
            value +
            "</div>";
        });

        $("#r-change-way").html(content);
      });

      /**
       * 切换翻页方式
       */
      $("#r-change-way").on("click", ".r_change_way_li", function () {
        changeKey = $(this).attr("data-key");
        $(".r_change_way_li").removeClass("r_change_way_li_select");
        $(this).addClass("r_change_way_li_select");

        $("#r-section").css("overflow", "visible");
        rSection.style.setProperty("column-width", contentWidth + "px");
        if (changeKey === "1") {
          $("#r-section").css("overflow", "auto");
          rSection.style.setProperty("column-width", "unset");
          $("#r-section").css("transform", "translateX(0px)");
        }

        // 隐藏操作栏
        hiddenTool();
      });

      /**
       * 左右翻页
       */
      let touch = {
        startX: 0,
        count: 0,
      };

      /**
       * 阅读器弹出操作栏或左右翻页效果
       */
      let isMoving = false;
      let ifShowAction = false;
      let willAction = "";
      rContent.addEventListener("touchstart", function (event) {
        touch.startX = event.targetTouches[0].pageX;
        if (
          touch.startX > contentWidth / 3 &&
          touch.startX < (contentWidth * 2) / 3
        ) {
          ifShowAction = true;
          // 如果需要阻止默认事件（例如点击事件，根据上下文决定是否取消注释）
          event.preventDefault();
        }

        if (changeKey === "1") {
          // 上下滚动
          return;
        }
        if (isMoving) {
          return;
        }
        if (touch.startX < contentWidth / 3) {
          // 当前为第一页，该例子为一章
          if (touch.count <= 0) {
            willAction = "";
            return;
          }
          // 向上翻页
          willAction = "prev";
        }

        if (touch.startX > (contentWidth * 2) / 3) {
          if (touch.count >= maxCount) {
            willAction = "";
            return;
          }
          // 向下翻页
          willAction = "next";
        }
      });
      rContent.addEventListener("touchmove", function (event) {
        if (!isMoving) {
          isMoving = true;
        }
        let moveX = event.targetTouches[0].pageX;
        let moveDistance = moveX - touch.startX;
        if (
          (touch.count <= 0 && moveDistance > 0) ||
          (touch.count >= maxCount && moveDistance < 0)
        ) {
          willAction = "";
          return;
        }
        let translateWidth = -contentWidth * touch.count + moveDistance;
        if (moveDistance >= contentWidth / 4) {
          willAction = "prev";
        } else if (moveDistance <= -contentWidth / 4) {
          willAction = "next";
        } else {
          willAction = "";
        }
        rSection.style.setProperty("transition", "none");
        rSection.style.transform = `translateX(${translateWidth}px)`;
      });
      rContent.addEventListener("touchend", (e) => {
        if (ifShowAction && touch.startX === e.changedTouches[0].pageX) {
          // 弹出操作栏
          rFooter.style.display = "block";
          rHeader.style.display = "flex";
          rMask.style.visibility = "visible";
          ifShowAction = false;
          return;
        } else {
          rSection.style.setProperty("transition", "transform 0.6s");
          if (!willAction) {
            // 恢复原位
            rSection.style.transform = `translateX(${
              -contentWidth * touch.count
            }px)`;
          } else {
            if (willAction === "next") {
              touch.count++;
            } else {
              touch.count--;
            }
            willAction = "";
            let translateWidth = -contentWidth * touch.count;
            rSection.style.transform = `translateX(${translateWidth}px)`;
          }
        }
        setTimeout(() => {
          isMoving = false;
        }, 600);
      });

      /**
       * 操作操作栏
       */
      $("#r-mask").click(function () {
        hiddenTool();
      });

      /**
       * 隐藏操作栏
       */
      function hiddenTool() {
        $("#r-footer").css("display", "none");
        $("#r-header").css("display", "none");
        $("#r-theme-box").css("display", "none");
        $("#r-setting-box").css("display", "none");
        $("#r-progress-box").css("display", "block");
        $("#r-change-style").css("display", "none");
        $("#r-mask").css("visibility", "hidden");
      }
    </script>
  </body>
</html>
